<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- =========================
         BUSQUEDA
    ========================== -->
    <record id="view_biblioteca_prestamo_search" model="ir.ui.view">
        <field name="name">biblioteca.prestamo.search</field>
        <field name="model">biblioteca.prestamo</field>   
        <field name="type">search</field> <!-- Asegúrate de que el tipo sea correcto -->     
        <field name="arch" type="xml">

                <search string="Buscar referencia">
                    <field name="name" string="Referencia prestamo"/>
                    <field name="libro_id" string="Libro"/>
                    <field name="socio_id" string="Socio"/>
                    <filter string="Prestamos activos" 
                            name="prestamos_activos_filter" 
                            domain="[('estado', '=', 'activo')]"/>
                    
                    <separator/>
                    <filter string="Prestamos con retraso" 
                            name="prestamos_retraso_filter" 
                            domain="[('estado', '=', 'retraso')]"/>
                    
                    <separator/>
                    <filter string="Prestamos devueltos" 
                            name="prestamos_devueltos_filter" 
                            domain="[('estado', '=', 'devuelto')]"/>
                    
                    <separator/>
                    
                    <group expand="0" string="Agrupar por">
                        <filter string="Estado" 
                                name="group_by_prestamo_estado" 
                                domain="[]" 
                                context="{'group_by': 'estado'}"/>
                    </group>
                    <group expand="0" string="Agrupar por">
                        <filter string="Socio" 
                                name="group_by_prestamo_socio" 
                                domain="[]" 
                                context="{'group_by': 'socio_id'}"/>
                    </group>
                </search>
            
                
                
                
            
        </field>
    </record>
    <!-- =========================
         VISTA TREE
    ========================== -->
    <record id="view_biblioteca_prestamo_tree" model="ir.ui.view">
        <field name="name">biblioteca.prestamo.tree</field>
        <field name="model">biblioteca.prestamo</field>
        <field name="arch" type="xml">
            <tree string="Préstamos">

                <field name="name"/>
                <field name="libro_id"/>
                <field name="socio_id"/>
                <field name="fecha_prestamo"/>
                <field name="fecha_devolucion_prevista"/>
                <field name="fecha_devolucion_real"/>
                <field name="estado"
                    widget="badge"
                    decoration-success="estado == 'devuelto'"
                    decoration-danger="estado == 'retraso'"
                    decoration-warning="estado == 'activo'"
                    />
            </tree>
        </field>
    </record>


    <!-- =========================
         VISTA FORM
    ========================== -->
    <record id="view_biblioteca_prestamo_form" model="ir.ui.view">
        <field name="name">biblioteca.prestamo.form</field>
        <field name="model">biblioteca.prestamo</field>
        <field name="arch" type="xml">
            
            <form string="Préstamo">
                    <header>
                        <button name="devolver_libro" 
                            string="Devolución Libro" 
                            type="object" 
                            class="btn-success btn-lg"
                            attrs="{'invisible': ['|',('estado', '=', 'devuelto'), ('id', '=', False)]}"/>

                        <button name="boton_fantasma" 
                            string="Devolución Libro" 
                            type="object" 
                            disabled="1"
                            class="btn-success btn-lg"
                            attrs="{'invisible': [('estado', '!=', 'devuelto'), ('id', '!=', False)]}"/>
                            
                            
                        <field name="estado" widget="statusbar" statusbar_visible="activo,retraso,devuelto"/>
                    </header>
            
                
                <sheet>

                    
                    
                    

                   
                    <div class="d-flex justify-content-between align-items-center mb-3" style="border: 2px solid #eeeeee; border-radius: 5px; padding: 15px;">
                        
                        <div class="oe_title">
                            
                                <separator string="Referencia Prestamo:"/>
                                <field name="name" readonly="1"/>
                                
                            
                        </div>
                        
                        <div class="oe_title">
                            
                                <separator string="Fecha Entrega prevista:"/>
                                <field name="fecha_devolucion_prevista" readonly="1"/>
                                
                            
                        </div>
                        <div class="oe_title">
                            
                                <separator string="Fecha Devolución:"/>
                                <field name="fecha_devolucion_real" readonly="1"/>
                                
                                
                            
                        </div>
                        
                                

                        
                        
                    </div>
                    
                    <div  style="border: 2px solid #eeeeee; border-radius: 5px; padding: 15px;">
                    <group string="Datalles prestamo">
                        <group>
                            <field name="libro_id"/>
                            
                        </group>

                        <group>
                            <field name="socio_id"/>
                        </group>
                        <group>
                            <field name="fecha_prestamo"/> 
                                                    
                        </group>
                        <group>
                            
                            <field name="notas"/>                           
                        </group>
                    </group>
                    
                    </div>

                    

                    

                </sheet>
            </form>
        </field>
    </record>


   


    <!-- =========================
         ACCIÓN
    ========================== -->
    <record id="action_biblioteca_prestamo" model="ir.actions.act_window">
        <field name="name">Préstamos</field>
        <field name="res_model">biblioteca.prestamo</field>
        <field name="view_mode">tree,form</field>
        
    </record>

    


    <!-- =========================
         MENÚ
    ========================== -->

    <!-- Cambia el parent según tu módulo -->
    <menuitem id="menu_biblioteca_prestamo"
              name="Préstamos"
              parent="menu_biblioteca_root"
              action="action_biblioteca_prestamo"
              sequence="40"/>

</odoo>
